Maxmind GeoIP + MySQL howto by Martin Lindhe

Based on document at http://www.delau.net/php/geoip.html


How to start for the first time:
--------------------------------
1. Download http://www.maxmind.com/download/geoip/database/GeoIPCountryCSV.zip
	Updated the 1:st of each month
	
	
2. Make tables:
CREATE TABLE import_geo_csv (
  start_ip CHAR(15) NOT NULL,
  end_ip CHAR(15) NOT NULL,
  start INT UNSIGNED NOT NULL,
  end INT UNSIGNED NOT NULL,
  cc CHAR(2) NOT NULL,
  cn VARCHAR(50) NOT NULL
);

CREATE TABLE import_geo_cc (
  ci TINYINT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
  cc CHAR(2) NOT NULL,
  cn VARCHAR(50) NOT NULL
);
CREATE TABLE tblGeoIP (
  start INT UNSIGNED NOT NULL,
  end INT UNSIGNED NOT NULL,
  ci TINYINT UNSIGNED NOT NULL
);


3. Import CSV file GeoIPCountryWhois.csv with SQLyog:

	1) Mark the table "import_geo_csv" & press Ctrl-Shift-M
	2) Click Change... to change import settings:
		Click "Fill Excel friendly values", then change so that:
		Escaped by: should be unchecked
		Lines terminated by: \n
		Fields - Variable Length:
			- Fields terminated by: ,
			- Fields enclosed by: "
	3) Click '...' to select the .csv file
	4) Click 'Import...' to start the data import


4. Optimize database

	Populate optimized country lookup table "import_geo_cc":
	INSERT INTO import_geo_cc SELECT DISTINCT NULL,cc,cn FROM import_geo_csv
	
	Populate optimized ip lookup table "tblGeoIP":
	INSERT INTO tblGeoIP SELECT start,end,ci FROM import_geo_csv NATURAL JOIN import_geo_cc


5. Re-generate functions_geoip_cc.php

	Log in to CMS, open admin_geoip.php
	follow instructions




How to update a existing GeoIP database:
----------------------------------------
1. Download a new http://www.maxmind.com/download/geoip/database/GeoIPCountryCSV.zip


2. Empty import table:

	TRUNCATE TABLE import_geo_csv
	TRUNCATE TABLE import_geo_cc
	TRUNCATE TABLE tblGeoIP


3. Import CSV file, see #3 above


4. Optimize database, see #4 above


5. Re-generate functions_geoip_cc.php, see #5 above